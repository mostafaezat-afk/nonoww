<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¥ Ù†Ø¸Ø§Ù… Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø·Ø¨ÙŠØ©</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #d32f2f;      /* âœ… Ø£Ø­Ù…Ø± Ø¨Ø¯Ù„ Ø£Ø²Ø±Ù‚ */
            --primary-light: #f44336;
            --primary-dark: #b71c1c;
            --success: #4caf50;
            --danger: #f44336;
        }
        
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-dark) 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        /* âœ… Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ (Fixed) */
        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            left: 20px;
            max-width: 500px;
            z-index: 9999;
            padding: 16px 20px;
            border-radius: 12px;
            display: none;
            animation: slideDown 0.5s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-100px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .alert-success {
            background: #4caf50;
            color: white;
            border: 2px solid #45a049;
        }
        
        .alert-error {
            background: #f44336;
            color: white;
            border: 2px solid #d32f2f;
        }
        
        .alert-info {
            background: #2196f3;
            color: white;
            border: 2px solid #1976d2;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            margin-top: 80px;  /* âœ… Ù…Ø³Ø§ÙØ© Ù„Ù„Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ */
        }
        
        .header-card {
            background: white;
            padding: 40px 20px;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            text-align: center;
        }
        
        .logo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 20px;
            border: 5px solid var(--primary-color);
            display: none;
        }
        
        .header-card h1 {
            font-size: 28px;
            color: var(--primary-color);
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header-card p {
            color: #666;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .booking-card {
            background: white;
            padding: 30px 20px;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }
        
        .selector-btn {
            padding: 14px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: #f8f9fa;
            color: #333;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-family: 'Cairo', sans-serif;
            word-wrap: break-word;
        }
        
        .selector-btn:hover {
            border-color: var(--primary-color);
            background: #fff3e0;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .selector-btn.selected {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(211,47,47,0.3);
        }
        
        /* âœ… Ù†Øµ ÙŠØ¸Ù„ ÙˆØ§Ø¶Ø­ Ø­ØªÙ‰ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ */
        .doctor-info {
            font-size: 11px;
            color: rgba(255,255,255,0.9);
            margin-top: 4px;
            background: rgba(0,0,0,0.1);
            padding: 2px 4px;
            border-radius: 4px;
        }
        
        .selector-btn.selected .doctor-info {
            color: rgba(255,255,255,0.95);
            background: rgba(0,0,0,0.15);
        }
        
        /* âœ… Ù…ÙˆØ¨Ø§ÙŠÙ„ responsive */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                margin-top: 100px;
            }
            
            .header-card, .booking-card {
                padding: 20px;
                border-radius: 16px;
            }
            
            .header-card h1 {
                font-size: 24px;
            }
            
            .selector-group {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)) !important;
            }
            
            .selector-btn {
                padding: 12px 8px;
                font-size: 13px;
            }
            
            .alert {
                right: 10px;
                left: 10px;
                top: 10px;
            }
        }
        
        /* âœ… Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .login-modal.active {
            display: flex;
        }
        
        .login-content {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        
        .login-content h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .login-content input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Cairo', sans-serif;
        }
        
        .login-content button {
            width: 100%;
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-dark) 100%);
            width: 100%;
            padding: 16px;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
            font-family: 'Cairo', sans-serif;
        }
    </style>
</head>
<body>
    <!-- âœ… Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    <div class="login-modal" id="loginModal">
        <div class="login-content">
            <h2>ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</h2>
            <input type="password" id="adminPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button onclick="verifyAdminPassword()">Ø¯Ø®ÙˆÙ„</button>
            <div style="color: red; margin-top: 10px; font-size: 12px;" id="loginError"></div>
        </div>
    </div>
    
    <!-- âœ… Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ -->
    <div class="alert" id="status"></div>
    
    <div class="container">
        <div class="header-card">
            <img src="" id="logo" class="logo" alt="Logo">
            <h1>ğŸ¥ <span id="placeName">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></h1>
            <p id="placeDescription"></p>
        </div>
        
        <div class="booking-card">
            <form id="bookingForm">
                <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø¨ÙŠØ¨ -->
                <div class="form-section">
                    <h2 style="font-size: 18px; color: var(--primary-color); margin-bottom: 15px;">ğŸ‘¨â€âš•ï¸ Ø§Ø®ØªØ± Ø§Ù„Ø·Ø¨ÙŠØ¨</h2>
                    <div id="doctor-selector" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px;"></div>
                    <input type="hidden" id="selectedDoctor" name="doctorName" required>
                </div>

                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶ -->
                <div class="form-section" style="margin-top: 30px;">
                    <h2 style="font-size: 18px; color: var(--primary-color); margin-bottom: 15px;">ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ</h2>
                    <input type="text" id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ *" required style="width: 100%; padding: 12px; margin-bottom: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: Cairo;">
                    <input type="tel" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *" required style="width: 100%; padding: 12px; margin-bottom: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: Cairo;">
                </div>

                <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ÙˆÙ‚Øª -->
                <div id="day-section" style="display: none; margin-top: 30px;">
                    <h2 style="font-size: 18px; color: var(--primary-color); margin-bottom: 15px;">ğŸ“… Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¹Ø¯</h2>
                    <div id="day-selector" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px;"></div>
                </div>

                <div id="time-section" style="display: none; margin-top: 20px;">
                    <div id="time-selector" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 12px;"></div>
                </div>

                <input type="hidden" id="appointmentTime" name="appointmentTime">
                <button type="submit" class="btn-submit" id="submitButton" disabled>ğŸ¯ Ø§Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ùƒ</button>
            </form>
        </div>
    </div>

    <script>
        let selectedDoctor = null;
        let slotsByDate = {};
        
        // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        function verifyAdminPassword() {
            const password = document.getElementById('adminPassword').value;
            if (password === '1111') {  // âœ… ØºÙŠÙ‘Ø± Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…
                document.getElementById('loginModal').classList.remove('active');
                alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
            } else {
                document.getElementById('loginError').textContent = 'ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©';
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            loadDoctors();
        });
        
        function loadSettings() {
            google.script.run.withSuccessHandler(function(data) {
                document.getElementById('placeName').textContent = data['Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù†'] || 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¬Ø²';
                document.getElementById('placeDescription').textContent = data['Ù†Ø¨Ø°Ø© Ù…Ø®ØªØµØ±Ø©'] || '';
            }).getSettings();
        }
        
        function loadDoctors() {
            google.script.run.withSuccessHandler(function(doctors) {
                const selector = document.getElementById('doctor-selector');
                selector.innerHTML = '';
                doctors.forEach(doc => {
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.className = 'selector-btn';
                    btn.innerHTML = `<strong>${doc.name}</strong><div class="doctor-info">${doc.specialty}</div>`;
                    btn.onclick = (e) => {
                        e.preventDefault();
                        selectDoctor(doc.name);
                    };
                    selector.appendChild(btn);
                });
            }).getDoctors();
        }
        
        function selectDoctor(name) {
            selectedDoctor = name;
            document.getElementById('selectedDoctor').value = name;
            document.querySelectorAll('#doctor-selector .selector-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.closest('.selector-btn').classList.add('selected');
            loadSlots(name);
        }
        
        function loadSlots(doctorName) {
            google.script.run.withSuccessHandler(function(slots) {
                processSlots(slots);
            }).getAvailableSlotsForDoctor(doctorName);
        }
        
        function processSlots(allSlots) {
            slotsByDate = {};
            const daySelector = document.getElementById('day-selector');
            daySelector.innerHTML = '';
            
            allSlots.forEach(slot => {
                const date = new Date(slot);
                // âœ… Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù…Ù† Ø§Ù„Ø³Ø¨Øª Ø¨Ø¯Ù„ Ø§Ù„Ø£Ø­Ø¯
                const dateStr = date.toLocaleDateString('ar-EG', { weekday: 'long', day: 'numeric', month: 'long' });
                if (!slotsByDate[dateStr]) slotsByDate[dateStr] = [];
                slotsByDate[dateStr].push(slot);
            });
            
            Object.keys(slotsByDate).forEach(dateStr => {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'selector-btn';
                btn.textContent = dateStr;
                btn.onclick = (e) => {
                    e.preventDefault();
                    selectDay(dateStr);
                };
                daySelector.appendChild(btn);
            });
            
            document.getElementById('day-section').style.display = 'block';
        }
        
        function selectDay(dateStr) {
            document.querySelectorAll('#day-selector .selector-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.closest('.selector-btn').classList.add('selected');
            
            const timeSelector = document.getElementById('time-selector');
            timeSelector.innerHTML = '';
            
            slotsByDate[dateStr].forEach(slot => {
                const time = new Date(slot).toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'selector-btn';
                btn.textContent = time;
                btn.onclick = (e) => {
                    e.preventDefault();
                    selectTime(slot);
                };
                timeSelector.appendChild(btn);
            });
            
            document.getElementById('time-section').style.display = 'block';
        }
        
        function selectTime(slot) {
            document.querySelectorAll('#time-selector .selector-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.closest('.selector-btn').classList.add('selected');
            document.getElementById('appointmentTime').value = slot;
            document.getElementById('submitButton').disabled = false;
        }
        
        document.getElementById('bookingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = 'â³ Ø¬Ø§Ø±Ù Ø§Ù„Ø­Ø¬Ø²...';
            statusDiv.className = 'alert alert-info';
            statusDiv.style.display = 'block';
            
            const formData = {
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                notes: '',
                appointmentTime: document.getElementById('appointmentTime').value,
                doctorName: selectedDoctor
            };
            
            google.script.run
                .withSuccessHandler(function(response) {
                    if (response.success) {
                        statusDiv.textContent = 'âœ… ' + response.message;
                        statusDiv.className = 'alert alert-success';
                        // âœ… Ø¨Ø¯Ù„ reload: Ø§Ù…Ø³Ø­ Ø§Ù„ÙÙˆØ±Ù… ÙÙ‚Ø·
                        document.getElementById('bookingForm').reset();
                        setTimeout(() => {
                            statusDiv.style.display = 'none';
                            location.reload();
                        }, 2000);
                    } else {
                        statusDiv.textContent = 'âŒ ' + response.message;
                        statusDiv.className = 'alert alert-error';
                    }
                })
                .bookAppointmentWithDoctor(formData);
        });
    </script>
</body>
</html>
