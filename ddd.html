<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø±Ø± Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ù…Ø®ØµØµ</title>
    <style>
        /* CSS Styles */
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#1a202c 0%,#2d3748 100%);min-height:100vh;padding:20px;color:#fff}.container{background:white;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.5);max-width:1000px;width:100%;margin:0 auto;padding:40px;color:#333}h1{color:#2d3748;text-align:center;margin-bottom:10px;font-size:2.5em}.subtitle{text-align:center;color:#667eea;margin-bottom:40px;font-size:1.1em}.upload-section{text-align:center;margin-bottom:30px}.upload-box{border:3px dashed #667eea;border-radius:15px;padding:40px;text-align:center;cursor:pointer;transition:all 0.3s;background:#f8f9fa;display:inline-block;min-width:100%;max-width:500px}.upload-box:hover{background:#e9ecef;border-color:#764ba2}.upload-icon{font-size:4em;margin-bottom:15px}.editor-section{display:none;margin-top:30px}.editor-section.active{display:block}.main-grid{display:grid;grid-template-columns:1fr 1fr;gap:30px}@media (max-width:768px){.main-grid{grid-template-columns:1fr}}.preview-container{position:relative;width:100%;background:#f0f0f0;border-radius:20px;overflow:hidden;aspect-ratio:1;box-shadow:0 10px 30px rgba(0,0,0,0.1)}#editorCanvas{display:block;width:100%;height:100%;cursor:move}.controls-area{background:#f8f9fa;padding:20px;border-radius:15px}.control-group{margin-bottom:15px}.control-group label{display:block;margin-bottom:8px;font-weight:600;color:#4a5568}input[type="range"]{width:100%;height:6px;background:#cbd5e0;border-radius:5px;outline:none;-webkit-appearance:none}input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:#667eea;cursor:pointer}.btn{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;padding:12px 30px;border-radius:50px;font-size:1em;cursor:pointer;width:100%;margin-bottom:10px;font-weight:bold}.btn-secondary{background:#cbd5e0;color:#4a5568}
        
        /* ØªØµÙ…ÙŠÙ… Ù‚Ø³Ù… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        .frames-selection {margin-top: 20px; text-align: center;}
        .frames-selection h3 {margin-bottom: 15px; color: #4a5568;}
        .frames-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        .frame-option {
            position: relative;
            cursor: pointer;
            border: 3px solid transparent;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.2s;
            aspect-ratio: 1;
        }
        .frame-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .frame-option.selected {
            border-color: #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.5);
            transform: scale(1.05);
        }
        .frame-option:hover {
            transform: translateY(-2px);
        }
        /* Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØµØ­ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ù…Ø®ØªØ§Ø± */
        .check-mark {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .frame-option.selected .check-mark {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ Ù…Ø­Ø±Ø± Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ø¨Ø±Ø§ÙˆÙŠØ²</h1>
        <div class="subtitle">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø·Ø§Ø±ØŒ Ø§Ø±ÙØ¹ ØµÙˆØ±ØªÙƒØŒ ÙˆØ­Ù…Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙˆØ±Ø§Ù‹</div>

        <div class="upload-section" id="uploadSection">
            <div class="upload-box" id="uploadArea">
                <div class="upload-icon">ğŸ“·</div>
                <h3>Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ ØµÙˆØ±ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
                <input type="file" id="fileInput" accept="image/*" style="display:none">
            </div>
        </div>

        <div class="editor-section" id="editorSection">
            <div class="main-grid">
                <div>
                    <div class="preview-container">
                        <canvas id="editorCanvas"></canvas>
                    </div>
                </div>

                <div class="controls-area">
                    <div class="frames-selection">
                        <h3>Ø§Ø®ØªØ± Ø´ÙƒÙ„ Ø§Ù„Ø¥Ø·Ø§Ø± ğŸ‘‡</h3>
                        <div class="frames-grid" id="framesContainer">
                            </div>
                    </div>

                    <hr style="border:0; border-top:1px solid #ddd; margin: 20px 0;">

                    <div class="control-group"><label>ØªÙƒØ¨ÙŠØ±/ØªØµØºÙŠØ±</label><input type="range" id="scaleSlider" min="50" max="200" value="100"></div>
                    <div class="control-group"><label>ØªØ­Ø±ÙŠÙƒ Ø£ÙÙ‚ÙŠ</label><input type="range" id="xSlider" min="-200" max="200" value="0"></div>
                    <div class="control-group"><label>ØªØ­Ø±ÙŠÙƒ Ø¹Ù…ÙˆØ¯ÙŠ</label><input type="range" id="ySlider" min="-200" max="200" value="0"></div>
                    <div class="control-group"><label>Ø¯ÙˆØ±Ø§Ù†</label><input type="range" id="rSlider" min="-180" max="180" value="0"></div>

                    <div style="margin-top: 20px;">
                        <button class="btn" onclick="downloadImage()">ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</button>
                        <button class="btn btn-secondary" onclick="location.reload()">ğŸ”„ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="frames.js"></script>

    <script>
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª
        if (typeof framesList === 'undefined') {
            alert('Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„Ù frames.js');
            // Ø¥Ø·Ø§Ø± Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø·ÙˆØ§Ø±Ø¦
            var framesList = [{id:0, url:'', preview:''}];
        }

        let currentFrameUrl = framesList[0].url; // Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø£ÙˆÙ„ ÙˆØ§Ø­Ø¯)
        let userImage = null;
        let frameImage = new Image();
        frameImage.crossOrigin = "anonymous";
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ­ÙƒÙ…
        let settings = { scale: 100, x: 0, y: 0, r: 0 };
        
        const canvas = document.getElementById('editorCanvas');
        const ctx = canvas.getContext('2d');

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ø±Ø³Ù… Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©)
        function initFramesList() {
            const container = document.getElementById('framesContainer');
            framesList.forEach((frame, index) => {
                const div = document.createElement('div');
                div.className = `frame-option ${index === 0 ? 'selected' : ''}`;
                div.onclick = () => selectFrame(frame.url, div);
                
                div.innerHTML = `
                    <img src="${frame.preview}" alt="${frame.name}">
                    <div class="check-mark">âœ”</div>
                `;
                container.appendChild(div);
            });
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø£ÙˆÙ„
            loadFrame(framesList[0].url);
        }

        // Ø¯Ø§Ù„Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ø¥Ø·Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·
        function selectFrame(url, element) {
            currentFrameUrl = url;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´ÙƒÙ„ (Ø§Ù„Ø³ÙŠÙ„ÙŠÙƒØª)
            document.querySelectorAll('.frame-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
            loadFrame(url);
        }

        function loadFrame(url) {
            frameImage.src = url;
            frameImage.onload = () => {
                if (userImage) draw(); // Ù„Ùˆ ÙÙŠÙ‡ ØµÙˆØ±Ø© Ù…Ø³ØªØ®Ø¯Ù… Ø§Ø±Ø³Ù… Ø¹Ù„Ù‰ Ø·ÙˆÙ„
            }
        }

        // Ù…Ù†Ø·Ù‚ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');

        uploadArea.onclick = () => fileInput.click();
        
        fileInput.onchange = (e) => {
            if (e.target.files && e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    userImage = new Image();
                    userImage.onload = () => {
                        document.getElementById('uploadSection').style.display = 'none';
                        document.getElementById('editorSection').classList.add('active');
                        canvas.width = 600;
                        canvas.height = 600;
                        draw();
                    };
                    userImage.src = ev.target.result;
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        };

        // Ù…Ù†Ø·Ù‚ Ø§Ù„Ø±Ø³Ù…
        function draw() {
            if (!userImage) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Ø±Ø³Ù… ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            ctx.save();
            ctx.translate(canvas.width/2, canvas.height/2);
            ctx.rotate(settings.r * Math.PI / 180);
            ctx.translate(-canvas.width/2, -canvas.height/2);
            
            const scale = (settings.scale / 100);
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªØºØ·ÙŠØ© (Cover)
            const scaleRatio = Math.max(canvas.width / userImage.width, canvas.height / userImage.height) * scale;
            
            const w = userImage.width * scaleRatio;
            const h = userImage.height * scaleRatio;
            
            ctx.drawImage(userImage, 
                (canvas.width - w) / 2 + settings.x, 
                (canvas.height - h) / 2 + settings.y, 
                w, h
            );
            ctx.restore();

            // Ø±Ø³Ù… Ø§Ù„Ø¥Ø·Ø§Ø± ÙÙˆÙ‚Ù‡Ø§
            if (frameImage.complete) {
                ctx.drawImage(frameImage, 0, 0, canvas.width, canvas.height);
            }
        }

        // Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
        document.getElementById('scaleSlider').oninput = (e) => { settings.scale = parseInt(e.target.value); draw(); };
        document.getElementById('xSlider').oninput = (e) => { settings.x = parseInt(e.target.value); draw(); };
        document.getElementById('ySlider').oninput = (e) => { settings.y = parseInt(e.target.value); draw(); };
        document.getElementById('rSlider').oninput = (e) => { settings.r = parseInt(e.target.value); draw(); };

        // Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function downloadImage() {
            const link = document.createElement('a');
            link.download = 'my-profile-frame.png';
            // Ù†Ù†Ø´Ø¦ ÙƒØ§Ù†ÙØ§Ø³ Ù…Ø¤Ù‚Øª Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø©
            const tempCanvas = document.createElement('canvas');
            const size = 1200; // Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© Ù„Ù„ØªØ­Ù…ÙŠÙ„
            tempCanvas.width = size;
            tempCanvas.height = size;
            const tCtx = tempCanvas.getContext('2d');

            // Ù†ÙØ³ Ù…Ù†Ø·Ù‚ Ø§Ù„Ø±Ø³Ù… Ø¨Ø³ Ø¹Ù„Ù‰ ÙƒØ¨ÙŠØ±
            tCtx.save();
            tCtx.translate(size/2, size/2);
            tCtx.rotate(settings.r * Math.PI / 180);
            tCtx.translate(-size/2, -size/2);
            
            const scale = (settings.scale / 100);
            const scaleRatio = Math.max(size / userImage.width, size / userImage.height) * scale;
            const w = userImage.width * scaleRatio;
            const h = userImage.height * scaleRatio;
            
            // Ù…Ø¶Ø§Ø¹ÙØ© Ù‚ÙŠÙ… Ø§Ù„Ø¥Ø²Ø§Ø­Ø© Ù„Ø£Ù† Ø§Ù„Ø­Ø¬Ù… ØªØ¶Ø§Ø¹Ù
            tCtx.drawImage(userImage, 
                (size - w) / 2 + (settings.x * 2), 
                (size - h) / 2 + (settings.y * 2), 
                w, h
            );
            tCtx.restore();
            
            if (frameImage.complete) {
                tCtx.drawImage(frameImage, 0, 0, size, size);
            }

            link.href = tempCanvas.toDataURL('image/png');
            link.click();
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª
        initFramesList();

    </script>
</body>
</html>
