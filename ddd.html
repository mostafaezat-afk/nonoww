<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø±Ø± Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª</title>
    <style>
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¹Ø§Ù…Ø© */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; margin-bottom: 10px; }
        .subtitle { text-align: center; color: #666; margin-bottom: 30px; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙØ¹ */
        .upload-box {
            border: 2px dashed #ccc; padding: 40px; text-align: center; cursor: pointer;
            border-radius: 10px; background: #fafafa; transition: 0.3s;
        }
        .upload-box:hover { border-color: #667eea; background: #f0f4ff; }
        
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø±Ø± (Ù…Ø®ÙÙŠØ© ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©) */
        .editor-area { display: none; margin-top: 20px; }
        .editor-grid { display: flex; flex-wrap: wrap; gap: 30px; }
        
        /* Ø§Ù„ÙŠÙ…ÙŠÙ†: Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ */
        .canvas-container {
            flex: 1; min-width: 300px;
            background: #eee; border-radius: 10px; overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            /* Ù„Ø¬Ø¹Ù„Ù‡Ø§ Ù…Ø±Ø¨Ø¹Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹ */
            aspect-ratio: 1; 
        }
        canvas { width: 100%; height: 100%; display: block; }

        /* Ø§Ù„ÙŠØ³Ø§Ø±: Ø§Ù„ØªØ­ÙƒÙ…Ø§Øª */
        .controls-container { flex: 1; min-width: 300px; }

        /* ØªÙ†Ø³ÙŠÙ‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙŠÙ…Ø§Øª (ØµÙˆØ± ÙˆØªØ­ØªÙ‡Ø§ ØªØ´ÙŠÙƒ Ø¨ÙˆÙƒØ³) */
        .frames-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        .frame-item {
            text-align: center;
            cursor: pointer;
            padding: 10px;
            border: 2px solid transparent;
            border-radius: 8px;
            transition: all 0.2s;
            background: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .frame-item:hover { transform: translateY(-2px); }
        .frame-item.active {
            border-color: #667eea;
            background: #f0f4ff;
        }
        .frame-item img {
            width: 100%;
            height: 80px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ù„Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ØµØºØ±Ø© */
            object-fit: contain;
            margin-bottom: 5px;
            border-radius: 4px;
        }
        /* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± (Radio) */
        .frame-selector {
            width: 20px; height: 20px; cursor: pointer;
            accent-color: #667eea; /* Ù„ÙˆÙ† Ø§Ù„Ø¹Ù„Ø§Ù…Ø© */
        }

        /* Ø£Ø´Ø±Ø·Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        .slider-group { margin-bottom: 15px; }
        .slider-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input[type=range] { width: 100%; cursor: pointer; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn {
            width: 100%; padding: 12px; border: none; border-radius: 50px;
            font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px;
            transition: 0.2s;
        }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5a6fd6; }
        .btn-secondary { background: #e2e8f0; color: #333; }
        .btn-secondary:hover { background: #cbd5e0; }

    </style>
</head>
<body>

<div class="container">
    <h1>ØªØµÙ…ÙŠÙ… ØµÙˆØ±ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</h1>
    <p class="subtitle">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ ÙˆØ§Ø±ÙØ¹ ØµÙˆØ±ØªÙƒ</p>

    <div class="upload-box" id="uploadBox">
        <div style="font-size: 40px;">ğŸ“·</div>
        <h3>Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø±ÙØ¹ ØµÙˆØ±ØªÙƒ</h3>
        <input type="file" id="fileInput" accept="image/*" style="display: none;">
    </div>

    <div class="editor-area" id="editorArea">
        <div class="editor-grid">
            
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>

            <div class="controls-container">
                
                <h4 style="margin-top:0">Ø§Ø®ØªØ± Ø§Ù„Ø´ÙƒÙ„:</h4>
                <div class="frames-list" id="framesContainer">
                    </div>

                <hr style="border: 0; border-top: 1px solid #ddd; margin: 20px 0;">

                <div class="slider-group">
                    <label>ØªÙƒØ¨ÙŠØ± / ØªØµØºÙŠØ±</label>
                    <input type="range" id="scale" min="10" max="200" value="100">
                </div>
                <div class="slider-group">
                    <label>ØªØ­Ø±ÙŠÙƒ Ø£ÙÙ‚ÙŠ (ÙŠÙ…ÙŠÙ†/ÙŠØ³Ø§Ø±)</label>
                    <input type="range" id="posX" min="-200" max="200" value="0">
                </div>
                <div class="slider-group">
                    <label>ØªØ­Ø±ÙŠÙƒ Ø±Ø£Ø³Ù‰ (ÙÙˆÙ‚/ØªØ­Øª)</label>
                    <input type="range" id="posY" min="-200" max="200" value="0">
                </div>

                <button class="btn btn-primary" onclick="downloadImage()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©</button>
                <button class="btn btn-secondary" onclick="location.reload()">ğŸ”„ ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            </div>
        </div>
    </div>
</div>

<script src="frames.js"></script>

<script>
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª
    if (typeof framesList === 'undefined') {
        alert('ØªÙ†Ø¨ÙŠÙ‡: Ù…Ù„Ù frames.js ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø£Ùˆ ÙØ§Ø±Øº!');
        var framesList = [];
    }

    // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    let canvas = document.getElementById('canvas');
    let ctx = canvas.getContext('2d');
    let userImg = new Image();
    let frameImg = new Image();
    frameImg.crossOrigin = "anonymous"; // Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± Ù…Ù† Ø±ÙˆØ§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠØ©

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    let settings = { scale: 100, x: 0, y: 0 };
    let currentFrameUrl = "";

    // 1. ØªÙˆÙ„ÙŠØ¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª (Thumbnails + Checkboxes)
    const framesContainer = document.getElementById('framesContainer');
    
    framesList.forEach((frame, index) => {
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§ÙˆÙŠ
        let div = document.createElement('div');
        div.className = 'frame-item';
        if (index === 0) div.classList.add('active'); // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹

        // HTML Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ: ØµÙˆØ±Ø© + Ø±Ø§Ø¯ÙŠÙˆ
        div.innerHTML = `
            <img src="${frame.thumb}" alt="${frame.name}">
            <br>
            <input type="radio" name="selectedFrame" class="frame-selector" 
                   value="${frame.url}" ${index === 0 ? 'checked' : ''}>
        `;

        // Ø­Ø¯Ø« Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ØµØ± Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
        div.onclick = function() {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù…Ø±Ø¦ÙŠ
            document.querySelectorAll('.frame-item').forEach(el => el.classList.remove('active'));
            div.classList.add('active');
            
            // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ
            div.querySelector('input').checked = true;

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ±ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯
            loadFrame(frame.url);
        };

        framesContainer.appendChild(div);
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ±ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø§Ù„Ø£ÙˆÙ„)
    if (framesList.length > 0) {
        loadFrame(framesList[0].url);
    }

    function loadFrame(url) {
        currentFrameUrl = url;
        frameImg.src = url;
        frameImg.onload = function() {
            draw();
        }
    }

    // 2. Ù…Ù†Ø·Ù‚ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
    document.getElementById('uploadBox').onclick = () => document.getElementById('fileInput').click();
    
    document.getElementById('fileInput').onchange = function(e) {
        if (e.target.files && e.target.files[0]) {
            let reader = new FileReader();
            reader.onload = function(event) {
                userImg.src = event.target.result;
                userImg.onload = function() {
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­Ø±Ø± ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±ÙØ¹
                    document.getElementById('uploadBox').style.display = 'none';
                    document.getElementById('editorArea').style.display = 'block';
                    
                    // ØªØ¹ÙŠÙŠÙ† Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³
                    canvas.width = 1000; // Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©
                    canvas.height = 1000;
                    
                    // ØªØµÙÙŠØ± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    settings = { scale: 100, x: 0, y: 0 };
                    document.getElementById('scale').value = 100;
                    document.getElementById('posX').value = 0;
                    document.getElementById('posY').value = 0;
                    
                    draw();
                }
            }
            reader.readAsDataURL(e.target.files[0]);
        }
    };

    // 3. Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ù… (Draw)
    function draw() {
        // Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Ø£. Ø±Ø³Ù… Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø´ÙØ§ÙÙŠØ© Ø®Ù„Ù Ø§Ù„ØµÙˆØ±Ø©)
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Ø¨. Ø±Ø³Ù… ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        if (userImg.src) {
            ctx.save();
            // Ù†Ù‚Ø·Ø© Ø§Ù„Ø§Ø±ØªÙƒØ§Ø² ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ
            ctx.translate(canvas.width/2, canvas.height/2);
            
            let scaleVal = settings.scale / 100;
            // Ù…Ø¹Ø§Ø¯Ù„Ø© Ù„Ø¬Ø¹Ù„ Ø§Ù„ØµÙˆØ±Ø© ØªØºØ·ÙŠ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ (Cover Style)
            let ratio = Math.max(canvas.width / userImg.width, canvas.height / userImg.height);
            let finalScale = ratio * scaleVal;
            
            let w = userImg.width * finalScale;
            let h = userImg.height * finalScale;
            
            // Ø§Ù„Ø±Ø³Ù… Ù…Ø¹ Ø§Ù„Ø¥Ø²Ø§Ø­Ø© (Ø§Ù„ØªØ­Ø±ÙŠÙƒ)
            // Ù†Ø¶Ø±Ø¨ Ø§Ù„Ø¥Ø²Ø§Ø­Ø© ÙÙŠ 5 Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ© Ø¹Ù†Ø¯ Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø±
            ctx.drawImage(userImg, -w/2 + (settings.x * 5), -h/2 + (settings.y * 5), w, h);
            
            ctx.restore();
        }

        // Ø¬. Ø±Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ… (PNG) ÙÙˆÙ‚ ÙƒÙ„ Ø´ÙŠØ¡
        if (frameImg.src) {
            ctx.drawImage(frameImg, 0, 0, canvas.width, canvas.height);
        }
    }

    // 4. ØªÙØ¹ÙŠÙ„ Ø£Ø´Ø±Ø·Ø© Ø§Ù„ØªØ­ÙƒÙ…
    document.getElementById('scale').oninput = function(e) { settings.scale = parseInt(e.target.value); draw(); };
    document.getElementById('posX').oninput = function(e) { settings.x = parseInt(e.target.value); draw(); };
    document.getElementById('posY').oninput = function(e) { settings.y = parseInt(e.target.value); draw(); };

    // 5. Ø§Ù„ØªØ­Ù…ÙŠÙ„
    function downloadImage() {
        let link = document.createElement('a');
        link.download = 'profile-design.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
    }

</script>

</body>
</html>
